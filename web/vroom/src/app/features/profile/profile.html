<div class="profile-container">

  <h1>Profile</h1>

  <!-- BASIC PROFILE -->
  <div class="profile-page" *ngIf="profile$ | async as profile; else loading">

    <section class="profile-section">

      <div class="avatar-wrapper">
        <div class="avatar-placeholder">
          Profile image
        </div>
      </div>

      <form class="profile-form" (submit)="false">

        <label>First Name</label>
        <div class="input-wrapper">
          <input type="text"
                 placeholder="Enter first name"
                 [ngModel]="profileData.firstName"
                 (ngModelChange)="profileData.firstName = $event"
                 name="firstName"
                 [disabled]="!editMode">
        </div>

        <label>Last Name</label>
        <div class="input-wrapper">
          <input type="text"
                 placeholder="Enter last name"
                 [ngModel]="profileData.lastName"
                 (ngModelChange)="profileData.lastName = $event"
                 name="lastName"
                 [disabled]="!editMode">
        </div>

        <label>Address</label>
        <div class="input-wrapper">
          <input type="text"
                 placeholder="Enter address"
                 [ngModel]="profileData.address"
                 (ngModelChange)="profileData.address = $event"
                 name="address"
                 [disabled]="!editMode">
        </div>

        <label>Phone Number</label>
        <div class="input-wrapper">
          <input type="tel"
                 placeholder="Enter phone number"
                 [ngModel]="profileData.phoneNumber"
                 (ngModelChange)="profileData.phoneNumber = $event"
                 name="phoneNumber"
                 [disabled]="!editMode">
        </div>

        <label>Email Address</label>
        <div class="input-wrapper">
          <input type="email"
                 placeholder="Enter email"
                 [ngModel]="profileData.email"
                 (ngModelChange)="profileData.email = $event"
                 name="email"
                 [disabled]="!editMode">
        </div>

      </form>

      <button
        class="change-button"
        (click)="onChange()">
        {{ editMode ? 'Save' : 'Change' }}
      </button>

      <button
        class="change-button"
        style="margin-top: 12px; background: #7da47d;"
        (click)="showPasswordModal = true">
        Change Password
      </button>

      <div *ngIf="successMessage" class="message success">{{ successMessage }}</div>
      <div *ngIf="errorMessage" class="message error">{{ errorMessage }}</div>

    </section>

    <!-- DRIVER INFO -->
    <div class="driver-wrapper"
         *ngIf="userRole === 'DRIVER' && profileData?.vehicle as vehicle">

      <section class="profile-section">
        <h2>Driver Activity</h2>
        <p>
          Active in last 24h:
          <strong>{{ profileData.activeHoursLast24h ?? 0 }} hours</strong>
        </p>
      </section>

      <section class="profile-section"> 
        <h2>Vehicle Information</h2>

        <p><strong>Brand:</strong> {{ vehicle.brand }}</p>
        <p><strong>Model:</strong> {{ vehicle.model }}</p>
        <p><strong>Number of seats:</strong> {{ vehicle.numberOfSeats }}</p>
        <p><strong>License plate:</strong> {{ vehicle.licenceNumber }}</p>

        <p>
          <strong>Babies allowed:</strong>
          {{ vehicle.babiesAllowed ? 'Yes' : 'No' }}
        </p>

        <p>
          <strong>Pets allowed:</strong>
          {{ vehicle.petsAllowed ? 'Yes' : 'No' }}
        </p>
      </section>

    </div>

  </div>

  <ng-template #loading>
    <p>Loading profile...</p>
  </ng-template>

  <!-- CHANGE PASSWORD MODAL -->
  <div class="modal-overlay" *ngIf="showPasswordModal" (click)="showPasswordModal = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <div class="profile-section" style="margin-bottom: 0;">
        <h2 class="section-title">Change Password</h2>

        <form class="profile-form" (submit)="onChangePassword()">

          <label>Old Password</label>
          <div class="input-wrapper">
            <input type="password"
                   placeholder="Enter old password"
                   [(ngModel)]="passwordData.oldPassword"
                   name="oldPassword">
          </div>

          <label>New Password</label>
          <div class="input-wrapper">
            <input type="password"
                   placeholder="Enter new password"
                   [(ngModel)]="passwordData.newPassword"
                   name="newPassword">
          </div>

          <label>Confirm New Password</label>
          <div class="input-wrapper">
            <input type="password"
                   placeholder="Confirm new password"
                   [(ngModel)]="passwordData.confirmNewPassword"
                   name="confirmNewPassword">
          </div>

          <button type="submit" class="change-button">
            Change Password
          </button>

          <button type="button" 
                  class="change-button" 
                  style="margin-top: 12px; background: #b0b0b0;"
                  (click)="showPasswordModal = false">
            Cancel
          </button>

          <div *ngIf="passwordSuccessMessage" class="message success">
            {{ passwordSuccessMessage }}
          </div>
          <div *ngIf="passwordErrorMessage" class="message error">
            {{ passwordErrorMessage }}
          </div>

        </form>
      </div>

    </div>
  </div>

</div>